<style>
.column-value-filter {
    position: absolute;
    top: calc(100% - 25px);
    left: 0;
    width: 200px; /* Fixed width for dropdowns */
    max-width: 300px;
    padding: 2px;
    border: 1px solid #ddd;
    border-radius: 3px;
    font-size: 12px;
    background: white;
    z-index: 1000;
}

th {
    position: relative;
    min-width: 100px;
    white-space: nowrap;
    padding-bottom: 45px; /* Space for dropdown */
}

/* Handle long text in dropdowns */
.column-value-filter option {
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.table-container {
    position: relative;
    margin-top: 10px; /* Add space above table */
}
</style>

<div id="databaseSection" class="section" style="margin-top: 30px;">
    
    <!-- Database Statistics -->
    <div class="stats-container" style="margin-bottom: 30px;">
        <div class="stat-card">
            <h3>{{ tables|length }}</h3>
            <p>Totale tabeller</p>
        </div>
        <div class="stat-card">
            <h3>{{ stats.total }}</h3>
            <p>Totale sp√∏rsm√•l</p>
        </div>
        <div class="stat-card">
            <h3>{{ images|length }}</h3>
            <p>Tilgjengelige bilder</p>
        </div>
    </div>
    
    {% if message %}
        <div class="message" style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #c3e6cb;">
            {{ message }}
        </div>
    {% endif %}
    
    <form method="POST" action="{{ url_for('admin.admin_dashboard') }}" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
        <h3 style="margin-top: 0;">üíª SQL-konsoll</h3>
        <textarea id="sql_query" name="sql_query" rows="5" style="width:100%; box-sizing:border-box; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: 'Courier New', monospace;"></textarea>
        <button type="submit" class="btn" style="margin-top: 10px;">‚ñ∂Ô∏è Kj√∏r SQL</button>
    </form>


    {% for table, rows in tables.items() %}
        <div class="table-section" data-table="{{ table }}" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
            <h3 style="color: #374151; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                 {{ table|upper|replace('_', ' ') }}
            </h3>
            <!-- Table-specific Filters -->
            <div class="search-filter-container enhanced-search" data-table="{{ table }}">
              <input type="text" class="search-input" placeholder="üîç Search {{ table|upper|replace('_', ' ') }}..." />
              <select name="per_page" class="per-page-selector">
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="all">Alle</option>
              </select>
              <button type="button" class="btn search-btn">üîç Search</button>
              <button type="button" class="btn btn-secondary clear-btn">üóëÔ∏è Clear</button>
              <div class="loading-indicator" style="display: none;">‚è≥ Loading...</div>
            </div>
            {% if rows %}

                <div class="table-container">
                    <div id="{{ table }}-results-info" class="results-info"></div>
                    <table id="{{ table }}-table" class="database-table">
                        <thead>
                            <tr>
                                {% for col in rows[0].keys() %}
                                <th class="sortable" data-field="{{ col }}" data-column="{{ col }}" data-table="{{ table }}">
                                    {{ col }} <span class="sort-indicator"></span>
                                </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in rows %}
                                <tr>
                                    {% for col in rows[0].keys() %}
                                        <td data-column="{{ col }}" style="color: black;">
                                            {% if table == 'traffic_signs' and col == 'filename' %}
                                                {% set matching = images | selectattr('filename', 'equalto', row[col]) | list %}
                                                {% if matching %}
                                                    {% set current_folder = matching[0].folder %}
                                                {% else %}
                                                    {% set current_folder = '' %}
                                                {% endif %}
                                                <img src="{{ url_for('static',
                                                    filename=( 'images/' ~ current_folder ~ '/' ~ row[col] )
                                                             if current_folder
                                                             else 'images/' ~ row[col]
                                                ) }}"
                                                     alt="{{ row[col] }}"
                                                     style="max-width: 100px;">
                                            {% else %}
                                                {{ row[col] }}
                                            {% endif %}
                                        </td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>(Ingen data i denne tabellen.)</p>
            {% endif %}
        </div>
        <!-- Pagination Controls -->
        <div class="pagination-controls" id="{{ table }}PaginationControls">
          <div class="pagination-info">
            <span id="{{ table }}PaginationInfo">Viser {{ table }}</span>
          </div>
          <div class="pagination-center">
            <div class="pagination-buttons" id="{{ table }}PaginationButtons"></div>
          </div>
          <div class="pagination-per-page">
            <label for="{{ table }}PerPageSelector">Vis per side:</label>
            <select id="{{ table }}PerPageSelector" name="per_page" class="per-page-selector">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="all">Alle</option>
            </select>
          </div>
        </div>
    {% endfor %}
    
</div>

<!-- Enhanced CSS for Database Section -->
<style>
/* Reuse enhanced styles from other sections */
.enhanced-filter-form {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.enhanced-search {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

.search-input {
  flex: 1;
  min-width: 300px;
  padding: 8px 12px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 14px;
}

.search-input:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.sortable {
  cursor: pointer;
  user-select: none;
  position: relative;
}

.sortable:hover {
  background-color: rgba(59, 130, 246, 0.1);
}

.sort-indicator {
  margin-left: 5px;
  opacity: 0.5;
}

.sort-indicator.asc::after {
  content: '‚Üë';
  color: #10b981;
}

.sort-indicator.desc::after {
  content: '‚Üì';
  color: #ef4444;
}

.results-info {
  margin-bottom: 10px;
  padding: 8px 12px;
  background: #f3f4f6;
  border-radius: 6px;
  font-size: 14px;
  color: #374151;
}

.loading-indicator {
  color: white;
  font-weight: bold;
}

.pagination-controls {
  margin-top: 20px;
  text-align: center;
}

.pagination {
  display: inline-flex;
  gap: 5px;
  align-items: center;
}

.page-btn {
  padding: 8px 12px;
  border: 1px solid #d1d5db;
  background: white;
  color: #374151;
  border-radius: 6px;
  cursor: pointer;
  text-decoration: none;
}

.page-btn:hover {
  background: #f3f4f6;
}

.page-btn.active {
  background: #3b82f6;
  color: white;
  border-color: #3b82f6;
}

.page-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.database-table {
  margin-bottom: 10px;
}

@media (max-width: 768px) {
  .enhanced-search {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-input {
    min-width: unset;
  }
}
</style>

<!-- Include shared enhancements -->
<script src="{{ url_for('static', filename='js/admin-base.js') }}"></script>
<!-- Include database-specific enhancements -->
<script src="{{ url_for('static', filename='js/admin/admin-database.js') }}"></script>
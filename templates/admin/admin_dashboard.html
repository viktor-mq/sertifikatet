<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>Adminpanel - Sertifikatet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <header class="admin-header" style="padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: space-between;">
      <div style="display: flex; align-items: center;">
        <a href="{{ url_for('main.index') }}">
          <img src="{{ url_for('static', filename='images/profiles/selskapslogo.png') }}"
               alt="Sertifikatet Logo"
               style="height: 40px; margin-right: 15px;">
        </a>
        <h1 style="font-size: 1.5rem; margin: 0; color: rgb(251, 191, 36)">Adminpanelet</h1>
      </div>
      <div>
        <a href="{{ url_for('auth.logout') }}" style="color: rgba(255, 255, 255, 0.885); text-decoration: none; font-weight: bold; margin-right: 60px;">
          Logg ut
        </a>
      </div>
    </header>
    
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}" style="
                        padding: 15px 20px;
                        margin-bottom: 15px;
                        border-radius: 8px;
                        border-left: 4px solid;
                        {% if category == 'success' %}
                            background-color: #d4edda;
                            color: #155724;
                            border-left-color: #28a745;
                        {% elif category == 'error' %}
                            background-color: #f8d7da;
                            color: #721c24;
                            border-left-color: #dc3545;
                        {% elif category == 'warning' %}
                            background-color: #fff3cd;
                            color: #856404;
                            border-left-color: #ffc107;
                        {% else %}
                            background-color: #d1ecf1;
                            color: #0c5460;
                            border-left-color: #17a2b8;
                        {% endif %}
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        ">
                        <strong>
                        {% if category == 'success' %}
                            ✅
                        {% elif category == 'error' %}
                            ❌
                        {% elif category == 'warning' %}
                            ⚠️
                        {% else %}
                            ℹ️
                        {% endif %}
                        </strong>
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <div class="container">

        <div class="section-tabs">
            <a href="#" class="btn active" onclick="showSection('questions')" id="questionsTab">📋 Spørsmål</a>
            <a href="#" class="btn" onclick="showSection('database')" id="databaseTab">💾 Database</a>
            <a href="#" class="btn" onclick="showSection('reports')" id="reportsTab">🛡️ Reports & Security</a>
            <a href="#" class="btn" onclick="showSection('manageUsers')" id="manageUsersTab">👥 Manage Users</a>
            <a href="#" class="btn" onclick="showSection('auditLog')" id="auditLogTab">📜 Audit Log</a>
            <a href="{{ url_for('admin.ml_settings') }}" class="btn">🤖 ML Settings</a>
            <a href="{{ url_for('admin.marketing_emails') }}" class="btn">📧 Marketing</a>
        </div>

        <!-- Questions Section -->
        {% include 'admin/questions.html' %}

        <!-- Database Section -->
        {% include 'admin/database_section.html' %}

        <!-- Reports & Security Section -->
        {% include 'admin/reports_section.html' %}

        <!-- Manage Users Section -->
        {% include 'admin/manage_users_section.html' %}

        <!-- Audit Log Section -->
        {% include 'admin/audit_log_section.html' %}
    </div>

    <script>
        // Section management
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.section-tabs .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            const selectedSection = document.getElementById(sectionName + 'Section');
            if (selectedSection) {
                selectedSection.classList.add('active');
            }
            
            // Add active class to selected tab
            const selectedTab = document.getElementById(sectionName + 'Tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show section that is already marked as active, or default to 'questions'
            const defaultSection = document.querySelector('.section.active')?.id?.replace('Section', '') || 'questions';
            showSection(defaultSection);
            
            // Handle external links in tabs (ML Settings, Marketing)
            document.querySelectorAll('.section-tabs a[href]:not([href="#"])').forEach(link => {
                link.addEventListener('click', function(e) {
                    // Allow the link to navigate normally for external pages
                    return true;
                });
            });
        });
    </script>
    
    <footer class="admin-footer" style="padding: 15px 20px; text-align: center; margin-top: 40px;">
        <p style="margin: 0; font-size: 0.9rem; color: rgb(176, 175, 175);">
            &copy; <span id="currentYear"></span> Sertifikatet. All rights reserved.
        </p>
    </footer>
    
    <script>
        // Set current year in footer
        document.addEventListener('DOMContentLoaded', function() {
            var yearSpan = document.getElementById('currentYear');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }
        });
    </script>
</body>
</html>